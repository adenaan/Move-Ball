<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Tap Soccer Duel</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #0e0e0e;
      color: #fff;
      text-align: center;
      overflow: hidden;
    }
    h1 {
      font-size: 2em;
      margin: 0.5em 0;
      color: #00f2ff;
      text-shadow: 0 0 10px #00f2ff;
    }
    #startScreen, #gameScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    input, button {
      font-size: 1.2em;
      padding: 0.5em 1em;
      margin: 0.5em;
      border: none;
      border-radius: 10px;
    }
    input {
      width: 70%;
      max-width: 300px;
      text-align: center;
    }
    button {
      background: #00f2ff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    #connectionStatus {
      position: absolute;
      top: 0.5em;
      left: 0.5em;
      font-size: 0.9em;
      color: #aaa;
    }
    #scoreboard {
      margin-top: 0.5em;
      font-size: 1.2em;
    }
    #bar {
      width: 90%;
      max-width: 500px;
      height: 10px;
      background: linear-gradient(to right, #333, #666);
      border-radius: 20px;
      position: relative;
      margin: 2em auto;
    }
    #ball {
      position: absolute;
      top: -10px;
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, #00f2ff, #0077aa);
      border-radius: 50%;
      box-shadow: 0 0 20px #00f2ff;
      transition: left 0.1s ease-out;
    }
    #tapButton {
      font-size: 1.4em;
      background: #fff;
      color: #000;
      padding: 1em 2em;
      border-radius: 15px;
      box-shadow: 0 0 10px #00f2ff;
      margin-top: 2em;
    }
    #winMessage {
      font-size: 1.6em;
      margin-top: 1em;
      color: #00ff88;
      animation: flash 0.5s ease-in-out 3 alternate;
      display: none;
    }
    @keyframes flash {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }
  </style>
</head>
<body>

<div id="startScreen">
  <h1>⚽ Tap Soccer Duel</h1>
  <input id="nameInput" type="text" placeholder="Enter your name" />
  <button id="startButton">Start Game</button>
</div>

<div id="gameScreen" style="display: none;">
  <h1>⚽ Tap Soccer Duel</h1>
  <div id="connectionStatus">Connecting...</div>
  <div id="scoreboard">Player1: 0 — Player2: 0</div>
  <div id="bar"><div id="ball" style="left: 50%;"></div></div>
  <button id="tapButton">TAP</button>
  <div id="winMessage"></div>
</div>

<script>
let socket;
let playerIndex = null;
let names = ["Waiting...", "Waiting..."];
let scores = [0, 0];
let playerName = "";

const startScreen = document.getElementById("startScreen");
const gameScreen = document.getElementById("gameScreen");
const nameInput = document.getElementById("nameInput");
const startButton = document.getElementById("startButton");
const connectionStatus = document.getElementById("connectionStatus");
const scoreboard = document.getElementById("scoreboard");
const tapButton = document.getElementById("tapButton");
const ball = document.getElementById("ball");
const winMessage = document.getElementById("winMessage");

function updateScoreboard() {
  scoreboard.textContent = `${names[0]}: ${scores[0]} — ${names[1]}: ${scores[1]}`;
}

function showWin(winnerIndex) {
  if (playerIndex === null) return;

  if (playerIndex === winnerIndex) {
    winMessage.textContent = "You Win!";
    winMessage.style.color = "#00ff88";
  } else {
    winMessage.textContent = "You Lose!";
    winMessage.style.color = "#ff0033";
  }
  winMessage.style.display = "block";
  setTimeout(() => {
    winMessage.style.display = "none";
  }, 1500);
}

function connectWebSocket() {
  connectionStatus.textContent = "Connecting...";
  socket = new WebSocket("wss://move-ball-server.glitch.me");

  socket.addEventListener("open", () => {
    connectionStatus.textContent = "Connected";
    socket.send(JSON.stringify({ type: "name", name: playerName }));
  });

  socket.addEventListener("message", (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "init") {
      playerIndex = data.playerIndex;
      names = data.names;
      scores = data.scores;
      updateScoreboard();
      ball.style.left = "50%";
    }

    if (data.type === "names") {
      names = data.names;
      updateScoreboard();
    }

    if (data.type === "ball") {
      const percent = 50 + (data.position * 10);
      ball.style.left = `${percent}%`;
    }

    if (data.type === "win") {
      scores = data.scores;
      updateScoreboard();
      showWin(data.winner);
    }

    if (data.type === "reset") {
      scores = [0, 0];
      names = ["Waiting...", "Waiting..."];
      updateScoreboard();
      ball.style.left = "50%";
    }
  });

  socket.onclose = () => {
    connectionStatus.textContent = "Disconnected";
  };
}

startButton.addEventListener("click", () => {
  playerName = nameInput.value.trim();
  if (playerName.length === 0) return;

  connectWebSocket();

  startScreen.style.display = "none";
  gameScreen.style.display = "flex";
});

tapButton.addEventListener("touchstart", (e) => {
  e.preventDefault();
  socket?.send(JSON.stringify({ type: "tap" }));
}, { passive: false });

tapButton.addEventListener("click", () => {
  socket?.send(JSON.stringify({ type: "tap" }));
});
</script>

</body>
</html>
