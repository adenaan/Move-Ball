let socket;
let playerIndex = null;
let myName = "";
const startScreen = document.getElementById("start-screen");
const gameScreen = document.getElementById("game-screen");
const startBtn = document.getElementById("startBtn");
const nameInput = document.getElementById("nameInput");
const tapBtn = document.getElementById("tapBtn");
const ball = document.getElementById("ball");
const msg = document.getElementById("message");
const connStatus = document.getElementById("connectionStatus");

startBtn.addEventListener("click", () => {
  myName = nameInput.value.trim() || "Player";
  socket.send(JSON.stringify({ type: "name", name: myName }));
  startScreen.classList.add("hidden");
  gameScreen.classList.remove("hidden");
});

tapBtn.addEventListener("click", () => {
  socket.send(JSON.stringify({ type: "tap" }));
});

function updateBall(position) {
  const percent = (position + 5) * 10;
  ball.style.left = `${percent}%`;
}

function updateScores(names, scores) {
  document.getElementById("player1-name").textContent = names[0];
  document.getElementById("player2-name").textContent = names[1];
  document.getElementById("score1").textContent = scores[0];
  document.getElementById("score2").textContent = scores[1];
}

function showMessage(text) {
  msg.textContent = text;
  setTimeout(() => {
    msg.textContent = "";
  }, 1500);
}

socket = new WebSocket("wss://move-ball-server.glitch.me");

socket.onopen = () => {
  connStatus.textContent = "Connected";
};

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);

  if (data.type === "init") {
    playerIndex = data.playerIndex;
    updateScores(data.names, data.scores);
  }

  if (data.type === "names") {
    updateScores(data.names, [0, 0]);
  }

  if (data.type === "start") {
    updateBall(data.ball.position);
  }

  if (data.type === "ball") {
    updateBall(data.position);
  }

  if (data.type === "win") {
    showMessage(data.winner === playerIndex ? "You Win!" : "You Lose!");
    updateScores(data.names, data.scores);
  }

  if (data.type === "reset") {
    location.reload();
  }
};
