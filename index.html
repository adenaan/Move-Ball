const ws = new WebSocket(location.origin.replace(/^http/, 'ws'));
let playerIndex = null;
let playerNames = [];
let myName = '';

const playersDiv = document.getElementById('players');
const nameInput = document.getElementById('nameInput');
const tapBtn = document.getElementById('tapBtn');
const ballDiv = document.getElementById('ball');
const messageDiv = document.getElementById('message');

nameInput.addEventListener('change', () => {
  myName = nameInput.value.trim();
  if (myName) {
    ws.send(JSON.stringify({ type: 'name', name: myName }));
  }
});

tapBtn.addEventListener('click', () => {
  ws.send(JSON.stringify({ type: 'tap' }));
});

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);

  if (msg.type === 'init') {
    playerIndex = msg.playerIndex;
    playerNames = msg.names;
    updatePlayers();
  }

  if (msg.type === 'names') {
    playerNames = msg.names;
    updatePlayers();
  }

  if (msg.type === 'ball') {
    ballDiv.textContent = msg.direction === 0 ? '⬅️' : '➡️';
  }

  if (msg.type === 'win') {
    messageDiv.textContent = `${playerNames[msg.winner]} wins!`;
  }

  if (msg.type === 'start') {
    messageDiv.textContent = '';
    ballDiv.textContent = '⚪';
  }

  if (msg.type === 'reset') {
    messageDiv.textContent = 'Player left. Resetting...';
    ballDiv.textContent = '⚪';
    playersDiv.textContent = 'Waiting for players...';
  }

  if (msg.type === 'full') {
    messageDiv.textContent = 'Game full. Please try again later.';
    tapBtn.disabled = true;
  }
};

function updatePlayers() {
  playersDiv.textContent = `You: ${playerNames[playerIndex] || '...'}. Opponent: ${playerNames[1 - playerIndex] || 'waiting...'}`;
}
