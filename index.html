<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon Push Game</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #000;
      color: #0ff;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100vh;
    }
    #arena {
      font-size: 3rem;
      margin: 20px;
    }
    .tap-zone {
      flex: 1;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .tap-btn {
      font-size: 2rem;
      padding: 20px;
      background: #0ff;
      color: #000;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 10px #0ff;
    }
    #startBtn {
      font-size: 1.5rem;
      padding: 10px 20px;
      margin: 10px auto;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 10px #0f0;
    }
  </style>
</head>
<body>
  <h1>Neon Clash</h1>
  <div id="names">Waiting for players...</div>
  <div id="score">0 - 0</div>
  <input id="nameInput" placeholder="Enter your name" />
  <div id="arena">⬤––––––</div>
  <div id="message"></div>

  <button id="startBtn">Start Game</button>

  <div class="tap-zone" id="tapZoneTop">
    <button class="tap-btn" id="tapBtnTop">TAP</button>
  </div>
  <div class="tap-zone" id="tapZoneBottom">
    <button class="tap-btn" id="tapBtnBottom">TAP</button>
  </div>

  <script>
    const ws = new WebSocket(location.origin.replace(/^http/, 'ws'));
    const nameInput = document.getElementById("nameInput");
    const startBtn = document.getElementById("startBtn");
    const tapZoneTop = document.getElementById("tapZoneTop");
    const tapZoneBottom = document.getElementById("tapZoneBottom");
    const arena = document.getElementById("arena");
    const namesDiv = document.getElementById("names");
    const scoreDiv = document.getElementById("score");
    const message = document.getElementById("message");

    let playerIndex = -1;
    let names = ["Waiting...", "Waiting..."];
    let readyToStart = false;

    nameInput.addEventListener("change", () => {
      ws.send(JSON.stringify({ type: "name", name: nameInput.value }));
    });

    startBtn.addEventListener("click", () => {
      if (readyToStart) {
        ws.send(JSON.stringify({ type: "tap" }));
        startBtn.style.display = "none";
        tapZoneTop.style.display = "flex";
        tapZoneBottom.style.display = "flex";
      }
    });

    document.getElementById("tapBtnTop").onclick = () => {
      if (playerIndex === 0) ws.send(JSON.stringify({ type: "tap" }));
    };
    document.getElementById("tapBtnBottom").onclick = () => {
      if (playerIndex === 1) ws.send(JSON.stringify({ type: "tap" }));
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      switch (data.type) {
        case "init":
          playerIndex = data.playerIndex;
          names = data.names;
          namesDiv.textContent = `${names[0]} vs ${names[1]}`;
          scoreDiv.textContent = `${data.scores[0]} - ${data.scores[1]}`;
          readyToStart = (data.names[1] !== "Waiting...");
          startBtn.disabled = !readyToStart;
          break;

        case "names":
          names = data.names;
          namesDiv.textContent = `${names[0]} vs ${names[1]}`;
          readyToStart = (names[1] !== "Waiting...");
          startBtn.disabled = !readyToStart;
          break;

        case "start":
          arena.textContent = "⬤––––––";
          message.textContent = "Game started!";
          break;

        case "ball":
          const pos = 3 + data.position;
          const track = Array(7).fill("–");
          track[pos] = "⬤";
          arena.textContent = track.join("");
          break;

        case "win":
          scoreDiv.textContent = `${data.scores[0]} - ${data.scores[1]}`;
          message.textContent = `${names[data.winner]} wins!`;
          break;

        case "reset":
          location.reload();
          break;
      }
    };
  </script>
</body>
</html>
