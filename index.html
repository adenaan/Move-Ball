<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tap Clash</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 10px;
      text-align: center;
    }
    #gameTitle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }
    #ballIcon {
      width: 20px;
      height: 20px;
      background: #0ff;
      border-radius: 50%;
    }
    #startScreen, #gameScreen {
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #startScreen.active, #gameScreen.active {
      display: flex;
    }
    input {
      padding: 10px;
      margin: 5px;
      font-size: 1em;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 10px;
      cursor: pointer;
    }
    #bar {
      width: 80vw;
      height: 10px;
      background: #333;
      position: relative;
      margin: 30px 0;
    }
    #ball {
      width: 20px;
      height: 20px;
      background: #0ff;
      border-radius: 50%;
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
    }
    .names {
      display: flex;
      justify-content: space-between;
      width: 80vw;
    }
    .scores {
      display: flex;
      justify-content: space-between;
      width: 80vw;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div id="gameTitle">
    <div id="ballIcon"></div>
    <h1>Tap Clash</h1>
  </div>

  <div id="startScreen" class="active">
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <button id="startBtn">Start</button>
    <p id="statusMsg"></p>
  </div>

  <div id="gameScreen">
    <div class="names">
      <span id="name1">Waiting...</span>
      <span id="name2">Waiting...</span>
    </div>
    <div class="scores">
      <span id="score1">0</span>
      <span id="score2">0</span>
    </div>
    <div id="bar">
      <div id="ball"></div>
    </div>
    <button id="tapBtn">TAP!</button>
    <p id="winnerMsg"></p>
  </div>

  <script>
    let socket;
    let playerID;
    let playerName;
    let names = ["Waiting...", "Waiting..."];
    let scores = [0, 0];

    const startScreen = document.getElementById("startScreen");
    const gameScreen = document.getElementById("gameScreen");
    const startBtn = document.getElementById("startBtn");
    const nameInput = document.getElementById("nameInput");
    const statusMsg = document.getElementById("statusMsg");
    const tapBtn = document.getElementById("tapBtn");
    const name1 = document.getElementById("name1");
    const name2 = document.getElementById("name2");
    const score1 = document.getElementById("score1");
    const score2 = document.getElementById("score2");
    const ball = document.getElementById("ball");
    const winnerMsg = document.getElementById("winnerMsg");

    startBtn.addEventListener("click", () => {
      playerName = nameInput.value.trim();
      if (!playerName) return;

      socket = new WebSocket(`wss://${location.host}`);

      socket.addEventListener("open", () => {
        socket.send(JSON.stringify({ type: "name", name: playerName }));
      });

      socket.addEventListener("message", (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "init") {
          playerID = data.playerID;
          names[playerID] = playerName;
          updateNameDisplay();
          startScreen.classList.remove("active");
          gameScreen.classList.add("active");
        } else if (data.type === "update") {
          ball.style.left = `${50 + data.ball / 2}%`;
          names = data.names;
          updateNameDisplay();
          if (data.winner !== null) {
            scores[data.winner]++;
            updateScores();
            winnerMsg.textContent = data.winner === playerID ? "You Win!" : "You Lose!";
            setTimeout(() => {
              winnerMsg.textContent = "";
            }, 2000);
          }
        } else if (data.type === "full") {
          statusMsg.textContent = "Room full. Try again later.";
        }
      });

      socket.addEventListener("close", () => {
        statusMsg.textContent = "Disconnected.";
      });
    });

    tapBtn.addEventListener("click", () => {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ type: "tap" }));
      }
    });

    function updateNameDisplay() {
      name1.textContent = names[0] || "Waiting...";
      name2.textContent = names[1] || "Waiting...";
    }

    function updateScores() {
      score1.textContent = scores[0];
      score2.textContent = scores[1];
    }
  </script>
</body>
</html>
