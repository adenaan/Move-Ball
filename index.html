<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Neon Push Duel</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
    }
    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }
    .title {
      font-size: 2em;
      margin-bottom: 20px;
    }
    .ball-title {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      margin-bottom: 1em;
    }
    .ball-title span {
      margin: 0 10px;
    }
    .ball {
      width: 20px;
      height: 20px;
      background: #0ff;
      border-radius: 50%;
      box-shadow: 0 0 10px #0ff;
    }
    #game {
      display: none;
      flex-direction: column;
      height: 100vh;
      justify-content: space-between;
    }
    .names {
      display: flex;
      justify-content: space-between;
      padding: 10px 20px;
      font-size: 1.2em;
    }
    .bar {
      height: 10px;
      background: #444;
      margin: auto 0;
      position: relative;
    }
    .ball-game {
      position: absolute;
      top: -15px;
      width: 30px;
      height: 30px;
      background: #0ff;
      border-radius: 50%;
      box-shadow: 0 0 15px #0ff;
    }
    #tap {
      padding: 15px 30px;
      background: #0ff;
      border: none;
      color: #000;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: 0 0 10px #0ff;
      margin: 20px auto;
      display: block;
      touch-action: manipulation;
    }
    #result {
      text-align: center;
      font-size: 1.5em;
      margin: 10px 0;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 1em;
      width: 80%;
      max-width: 300px;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 10px;
      cursor: pointer;
    }
    .scores {
      display: flex;
      justify-content: space-around;
      padding: 5px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <div class="centered" id="startScreen">
    <div class="ball-title"><span>Neon</span><div class="ball"></div><span>Clash</span></div>
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <button id="startBtn">Start</button>
  </div>

  <div id="game">
    <div class="names">
      <div id="p1Name">Player 1: waiting...</div>
      <div id="p2Name">Player 2: waiting...</div>
    </div>
    <div class="scores">
      <div id="score1">Wins: 0</div>
      <div id="score2">Losses: 0</div>
    </div>
    <div class="bar" id="bar">
      <div class="ball-game" id="ball"></div>
    </div>
    <div id="result"></div>
    <button id="tap">TAP</button>
  </div>

  <script>
    const socket = new WebSocket(`wss://${location.host}`);
    let myId = null;
    let myName = "";
    let playerSlot = null;

    const startScreen = document.getElementById('startScreen');
    const game = document.getElementById('game');
    const startBtn = document.getElementById('startBtn');
    const nameInput = document.getElementById('nameInput');
    const p1Name = document.getElementById('p1Name');
    const p2Name = document.getElementById('p2Name');
    const score1 = document.getElementById('score1');
    const score2 = document.getElementById('score2');
    const result = document.getElementById('result');
    const ball = document.getElementById('ball');
    const bar = document.getElementById('bar');

    let barWidth = window.innerWidth - 60;
    let ballPos = barWidth / 2;
    let ballSpeed = 0;

    function updateBall() {
      ball.style.left = `${ballPos}px`;
    }

    function clamp(val, min, max) {
      return Math.max(min, Math.min(max, val));
    }

    startBtn.onclick = () => {
      myName = nameInput.value.trim();
      if (myName.length === 0) return;
      socket.send(JSON.stringify({ type: "join", name: myName }));
    };

    document.getElementById('tap').addEventListener('click', () => {
      socket.send(JSON.stringify({ type: "tap" }));
    });

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);

      if (msg.type === "joined") {
        playerSlot = msg.slot;
        startScreen.style.display = 'none';
        game.style.display = 'flex';
      }

      if (msg.type === "state") {
        p1Name.textContent = `Player 1: ${msg.p1 || 'waiting...'}`;
        p2Name.textContent = `Player 2: ${msg.p2 || 'waiting...'}`;
        score1.textContent = `Wins: ${msg.p1Wins || 0}`;
        score2.textContent = `Losses: ${msg.p2Losses || 0}`;
        ballPos = clamp(msg.ballPos, 0, barWidth);
        updateBall();
      }

      if (msg.type === "result") {
        result.textContent = msg.text;
      }
    };

    window.addEventListener('resize', () => {
      barWidth = window.innerWidth - 60;
      updateBall();
    });
  </script>
</body>
</html>
