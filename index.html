<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Tap Arena</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; background: #0f0f0f; color: white; overflow: hidden; text-align: center; }
    #startScreen, #gameScreen { display: none; height: 100vh; align-items: center; justify-content: center; flex-direction: column; }
    .visible { display: flex !important; }
    input, button { padding: 10px 20px; font-size: 1.2em; border: none; border-radius: 5px; }
    button:active { transform: scale(0.98); }
    #bar { width: 100%; height: 10px; background: #444; margin: 30px 0; position: relative; overflow: hidden; border-radius: 5px; }
    #ball { width: 20px; height: 20px; background: #0ff; border-radius: 50%; position: absolute; top: -5px; transition: left 0.2s; box-shadow: 0 0 10px #0ff; }
    #tapBtn { padding: 20px 40px; font-size: 2em; background: #0ff; color: black; border-radius: 10px; margin-top: 30px; }
    #connection, #names, #scores { margin: 10px 0; font-size: 1.1em; }
    #message { font-size: 2em; color: yellow; margin-top: 20px; animation: flash 1s ease-in-out; }
    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="startScreen" class="visible">
    <h1>Tap Arena</h1>
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <button id="startBtn">Start</button>
    <div id="connection">Connecting to server...</div>
  </div>

  <div id="gameScreen">
    <div id="names"></div>
    <div id="scores"></div>
    <div id="bar"><div id="ball"></div></div>
    <button id="tapBtn">TAP!</button>
    <div id="message"></div>
  </div>

  <script>
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const nameInput = document.getElementById('nameInput');
    const startBtn = document.getElementById('startBtn');
    const connectionStatus = document.getElementById('connection');
    const namesEl = document.getElementById('names');
    const scoresEl = document.getElementById('scores');
    const tapBtn = document.getElementById('tapBtn');
    const ball = document.getElementById('ball');
    const message = document.getElementById('message');

    let playerIndex = null;
    let socket = new WebSocket("wss://move-ball-server.glitch.me");

    function updateBall(position) {
      const barWidth = document.getElementById('bar').clientWidth;
      const left = (barWidth / 2) + position * 30 - 10;
      ball.style.left = `${left}px`;
    }

    socket.addEventListener('open', () => {
      connectionStatus.textContent = 'Connected!';
    });

    socket.addEventListener('message', (event) => {
      const data = JSON.parse(event.data);

      if (data.type === 'init') {
        playerIndex = data.playerIndex;
        namesEl.textContent = `${data.names[0]} vs ${data.names[1] || '...waiting...'}`;
        scoresEl.textContent = `${data.names[0]}: ${data.scores[0]} | ${data.names[1]}: ${data.scores[1]}`;
      }
      else if (data.type === 'names') {
        namesEl.textContent = `${data.names[0]} vs ${data.names[1] || '...waiting...'}`;
      }
      else if (data.type === 'start') {
        updateBall(data.ball.position);
        message.textContent = '';
      }
      else if (data.type === 'ball') {
        updateBall(data.position);
      }
      else if (data.type === 'win') {
        scoresEl.textContent = `${data.names[0]}: ${data.scores[0]} | ${data.names[1]}: ${data.scores[1]}`;
        message.textContent = data.winner === playerIndex ? 'You Win!' : 'You Lose';
        setTimeout(() => { message.textContent = ''; }, 2000);
      }
      else if (data.type === 'reset') {
        location.reload();
      }
    });

    startBtn.addEventListener('click', () => {
      const name = nameInput.value.trim() || 'Player';
      socket.send(JSON.stringify({ type: 'name', name }));
      startScreen.classList.remove('visible');
      gameScreen.classList.add('visible');
    });

    tapBtn.addEventListener('click', (e) => {
      e.preventDefault();
      socket.send(JSON.stringify({ type: 'tap' }));
    });

    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = new Date().getTime();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>
