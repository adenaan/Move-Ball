<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ball Push Duel</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      overflow: hidden;
    }
    h1 {
      margin: 16px;
      font-size: 24px;
    }
    .names {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 0 20px;
      font-size: 18px;
    }
    canvas {
      background: #222;
      margin: 10px 0;
      border-radius: 12px;
    }
    #tapBtn {
      padding: 20px 40px;
      font-size: 24px;
      border: none;
      border-radius: 12px;
      background: #4caf50;
      color: white;
      margin: 16px;
    }
    #startContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 50px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
      border-radius: 8px;
      border: none;
    }
    #scoreboard {
      font-size: 16px;
      padding: 6px 20px;
    }
  </style>
</head>
<body>
  <h1>Ball Push Duel</h1>
  <div id="startContainer">
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <button id="startBtn">Start</button>
  </div>
  <div class="names">
    <div id="p1Name">Waiting...</div>
    <div id="p2Name">Waiting...</div>
  </div>
  <canvas id="gameCanvas" width="300" height="100"></canvas>
  <div id="scoreboard">Score: 0 - 0</div>
  <button id="tapBtn" style="display: none;">TAP!</button>

  <script>
    const socket = new WebSocket("wss://move-ball-server.glitch.me");

    let playerNumber = null;
    let playerName = "";
    let names = { 1: "Waiting...", 2: "Waiting..." };
    let scores = { 1: { wins: 0, losses: 0 }, 2: { wins: 0, losses: 0 } };

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const startBtn = document.getElementById("startBtn");
    const nameInput = document.getElementById("nameInput");
    const tapBtn = document.getElementById("tapBtn");

    const p1Name = document.getElementById("p1Name");
    const p2Name = document.getElementById("p2Name");
    const scoreboard = document.getElementById("scoreboard");

    let ballX = 150;
    const ballRadius = 10;

    function drawBall() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.arc(ballX, 50, ballRadius, 0, Math.PI * 2);
      ctx.fillStyle = "deepskyblue";
      ctx.fill();
    }

    function updateNamesDisplay() {
      p1Name.textContent = names[1] || "Waiting...";
      p2Name.textContent = names[2] || "Waiting...";
    }

    function updateScoreDisplay() {
      scoreboard.textContent = `Score: ${scores[1].wins} - ${scores[2].wins}`;
    }

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);

      if (data.type === "assign") {
        playerNumber = data.number;
        scores = data.scores;
        names = data.names;
        updateNamesDisplay();
        updateScoreDisplay();
      }

      if (data.type === "update-names") {
        names = data.names;
        updateNamesDisplay();
      }

      if (data.type === "start") {
        document.getElementById("startContainer").style.display = "none";
        tapBtn.style.display = "block";
        ballX = 150;
        drawBall();
      }

      if (data.type === "end") {
        scores = data.scores;
        updateScoreDisplay();
        const result = data.winner === playerNumber ? "You Win!" : "You Lose!";
        alert(result);
      }

      if (data.type === "reset") {
        tapBtn.style.display = "none";
        document.getElementById("startContainer").style.display = "flex";
      }
    };

    startBtn.onclick = () => {
      const name = nameInput.value.trim();
      if (name === "") return;

      playerName = name;
      socket.send(JSON.stringify({ type: "name", name }));
      socket.send(JSON.stringify({ type: "ready" }));
    };

    tapBtn.ontouchstart = tapBtn.onmousedown = () => {
      socket.send(JSON.stringify({ type: "tap" }));
    };

    drawBall();
  </script>
</body>
</html>
